<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Моделирование физики</title>
</head>
<body>
<canvas height='600' width='800' id='example'>Обновите браузер</canvas>
<script>
    var example = document.getElementById("example"),
        ctx = example.getContext('2d');

    // TODO: Двойной буфер для рисования
    /*  var canvas2 = document.createElement('canvas');
     canvas2.width = mainCtx.width;
     canvas2.height = mainCtx.height;
     var ctx = canvas2.getContext('2d'); */


    // Создать мячик с заданными координатами центра, скоростями
    // и радиусом
    function Ball(x, y, Vx, Vy, radius) {
        // Сохраняем свойства мячика
        // Координаты мячика
        this.x = x;
        this.y = y;
        // Скорость по x и y
        this.Vx = Vx;
        this.Vy = Vy;
        // Радиус мячика
        this.radius = radius;

        this.fillColor = "#4d8fff";
        this.strokeColor = "#1507ff";

        // Рисуем мячик
        this.draw = function () {
            // Цвет в формате RGB (3 байта)
            // Red (красный) Green (зелёный) Blue (синий)
            // Любой цвет задаётся комбинацией (суммой этих 3 компонент)
            // 1 байт = диапазон 0..255 = (в шестнадцатеричной системе счисления) 0..FF
            ctx.fillStyle = this.fillColor; // определяет цвет заливки
            ctx.strokeStyle = this.strokeColor;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 2 * this.radius, 0, 2 * Math.PI, true);
            ctx.fill();
            ctx.stroke();
        };

        // Перемещение мячика
        this.move = function () {
            // Меняем скорость в соответствии с силами
            this.Vy += 9.8;
            // Меняем координаты
            this.x += this.Vx * timeStep;
            this.y += this.Vy * timeStep;
            // TODO: Учесть сопротивление воздуха
            // Учесть столновение
            if (this.y >= (example.height - this.radius)) {
                // Столкновение с полом
                this.Vy = -this.Vy;
            }
            // Столкновение со стенками по x
            if (this.x <= this.radius || this.x >= (example.width - this.radius)) {
                this.Vx = -this.Vx;
            }
        }
    }

    // Учёт пересечений
    function collisions() {
        // TODO: Учесть столкновение между шариками
        for (var i = 0; i < balls.length; i++)
            for (var j = i + 1; j < balls.length; j++) {
                var a = balls[i];
                var b = balls[j];
                // Расстояние между центрами мячиков
                var dist = Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));
                if ((a.radius + b.radius) > dist) {
                    // Расстояние между центрами меньше суммы их радиусов
                    // есть столкновение
                    console.log("Столкновение! " + dist);
                    // TODO: должны отскакивать друг от друга
                }
            }
    }

    var b1 = new Ball(80, 100, 40, 0, 10);
    var b2 = new Ball(180, 120, 30, 0, 10);
    b2.fillColor = "#FF0000";
    b2.strokeColor = "#880000";
    var balls = [b1, b2];

    // Шаг по времени в секундах
    var timeStep = 1.0 / 60;

    // Рисуем поле на котором всё происходит
    function drawScene() {
        // Границы нашего поля
        ctx.fillStyle = "#FFFFFF";
        ctx.strokeStyle = "#000000";
        ctx.fillRect(0, 0, example.width, example.height);
        ctx.strokeRect(0, 0, example.width, example.height);
    }


    drawScene();
    for (var i = 0; i < balls.length; i++) {
        balls[i].draw();
    }
    // mainCtx.drawImage(canvas2, 0, 0);
    setInterval(function () {
        drawScene();
        for (var i = 0; i < balls.length; i++) {
            balls[i].move();
            balls[i].draw();
        }
        collisions();
        // mainCtx.drawImage(canvas2, 0, 0);
    }, timeStep * 1000);
</script>
</body>
</html>